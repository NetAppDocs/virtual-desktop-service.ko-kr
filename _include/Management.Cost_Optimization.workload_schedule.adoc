= 워크로드 스케줄링




== 워크로드 스케줄링

워크로드 스케줄링은 환경이 활성화된 기간을 예약할 수 있는 기능입니다.

워크로드 스케줄링은 "Always On", "Always Off" 또는 "Scheduled"로 설정할 수 있습니다. "Scheduled(예약됨)"로 설정하면 ON 및 OFF 시간을 각 요일의 서로 다른 시간 창으로 세분화할 수 있습니다.

image:Workload_schedule1.png[""]

"Always Off" 또는 "Scheduled"를 통해 꺼지도록 예약된 경우 모든 테넌트 가상 머신이 종료됩니다. 플랫폼 서버(예: CWMGR1)는 요청 시 깨우기 등의 기능을 지원하기 위해 활성 상태를 유지합니다.

워크로드 스케줄은 라이브 스케일링 및 요청 시 깨우기를 포함한 다른 리소스 최적화 기능과 함께 작동합니다.



== 필요에 따라 깨우세요

WoD(Wake on Demand)는 리소스가 비활성화되도록 예약된 경우에도 연중무휴 무인 액세스를 지원하기 위해 최종 사용자에게 적절한 VM 리소스를 깨울 수 있는 특허 출원 중인 기술입니다.



=== 원격 데스크톱 서비스용 WoD

RDS에서 VDS Windows 클라이언트는 주문형 깨우기 기능을 내장하고 있으며 추가적인 최종 사용자 작업 없이 적절한 리소스를 깨울 수 있습니다. 정상적인 로그인을 시작하기만 하면 클라이언트는 VM이 활성화되는 짧은 지연 시간을 알려 줍니다. 이 클라이언트(이 자동 켜짐 요청 기능)는 Windows 장치에서 RDS 환경으로 연결할 때만 사용할 수 있습니다.

유사한 기능이 RDS 배포를 위해 VDS 웹 클라이언트에 내장되어 있습니다. VDS 웹 클라이언트는 다음 사이트에서 찾을 수 있습니다. link:https://login.cloudworkspace.com[""]

WOL(Wake on Demand) 기능은 Microsoft RD 클라이언트(Windows 또는 기타 플랫폼의 경우) 또는 다른 타사 RD 클라이언트에 내장되어 있지 않습니다.



=== Azure Virtual Desktop에 대한 주문형 깨우기

AVD에서는 연결에 사용할 수 있는 클라이언트만 Microsoft에서 제공하므로 Wake on Demand 기능이 포함되어 있지 않습니다.

VDS에는 VDS 웹 클라이언트를 통한 AVD의 셀프 서비스 요청 시 깨우기 기능이 포함되어 있습니다. 웹 클라이언트를 사용하여 적절한 리소스를 깨우고 표준 AVD 클라이언트를 통해 연결을 시작할 수 있습니다.

.AVD에서 VM 리소스를 깨우려면:
. 에서 VDS 웹 클라이언트에 연결합니다 link:https://login.cloudworkspace.com[""]
. 사용자 AVD 자격 증명으로 로그인합니다
+
** "Microsoft의 AVD 서비스를 사용할 수 있습니다. 상태를 보고 오프라인 호스트 풀을 시작하려면 여기를 클릭하십시오." _


. "_here_"를 클릭하면 사용 가능한 호스트 풀 목록과 상태 열 아래에 "시작하려면 클릭하십시오" 링크가 표시됩니다
+
image:Wake_on_Demand_h5_1.png[""]

. _링크를 클릭하여 시작_하고 상태가 "온라인"으로 변경되고 녹색 상태 아이콘이 표시될 때까지 1-5분 정도 기다립니다
. 일반 프로세스를 사용하여 AVD에 연결합니다




== 실시간 배율 조정

라이브 확장은 워크로드 스케줄링에 구성된 대로 예약된 활성 시간 동안 온라인 세션 호스트 수를 관리하여 워크로드 스케줄링에 연동됩니다. 오프라인 상태로 예약된 경우 라이브 확장이 세션 호스트 가용성을 제어하지 않습니다. 라이브 확장은 RDS 및 AVD 환경에서 공유 사용자 및 공유 서버에만 영향을 미치며, VDI 사용자 및 VDI VM은 이러한 계산에서 제외됩니다. 다른 모든 VM 유형은 영향을 받지 않습니다.


NOTE: AVD_LOAD BALECEER TYPE_SETTING은 이 구성과 상호 작용하므로 해당 설정을 선택할 때 주의해야 합니다. 비용 절감 효과는 심층 우선 유형으로 극대화되고, 최종 사용자 성능은 폭넓은 우선 유형으로 극대화됩니다.

옵션을 선택하지 않고 라이브 확장을 활성화하면 자동화 엔진이 서버에서 추가 전원이 공급된 수, 서버당 공유 사용자 수 및 서버당 최대 공유 사용자 수에 대한 값을 자동으로 선택합니다.

* Server에 대한 추가 전원 공급 횟수 _ 기본값은 0입니다. 즉, 1개의 서버가 24시간 실행됩니다.
* _Shared Users per Server_는 기본적으로 회사 내의 사용자 수를 서버 수로 나눈 값입니다.
* Server_별 _Max 공유 사용자 기본값은 무한입니다.


Live Scaling은 사용자가 로그온할 때 서버를 켜고 사용자가 로그오프할 때 서버를 끕니다.

총 활성 사용자가 서버당 공유 사용자 수에 서버의 전원을 켠 총 수를 곱하면 추가 서버에 전원이 공급되면 자동으로 작동됩니다.

 e.g. With 5 Shared Users per Server set (this is the default # we’ll use for all examples in this article) and 2 servers running, a 3rd server won’t be powered up until server 1 & 2 both have 5 or more active users. Until that 3rd server is available, new connections will be load balanced all available servers. In RDS and AVD Breadth mode, Load balancing sends users to the server with the fewest active users (like water flowing to the lowest point). In AVD Depth mode, Load balancing sends users to servers in a sequential order, incrementing when the Max Shared Users number is reached.
또한 라이브 확장을 통해 서버를 비활성화하여 비용을 절감할 수 있습니다. 서버에 활성 사용자가 0명이고 다른 서버의 사용 가능한 용량이 서버당 _공유 사용자_보다 낮을 경우 빈 서버의 전원이 꺼지게 됩니다.

다음 서버의 전원을 켜는 데 몇 분 정도 걸릴 수 있습니다. 특정 상황에서는 로그인 속도가 새 서버의 가용성을 능가할 수 있습니다. 예를 들어, 15명이 5분 이내에 로그인하면 2차 및 3차 전원이 켜져 있는 동안 모든 사용자가 첫 번째 서버에 착륙하거나 세션이 거부됩니다. 이 시나리오에서는 단일 서버의 오버로드를 완화하기 위해 다음 두 가지 전략을 사용할 수 있습니다.

. 추가 서버가 켜져 있고 연결을 수락할 수 있으며 플랫폼이 추가 서버를 스핀업할 수 있는 시간을 허용하도록 서버에서 추가 전원을 공급한 수 _ 을(를) 활성화하십시오.
+
.. 이 기능을 활성화하면 계산된 필요에 숫자가 추가됩니다. 예를 들어, 추가 서버 1대(6명의 사용자가 연결된 경우)로 설정하면 사용자 수 때문에 서버 2대가 활성화되고, _Extra Powered on Servers_ 설정으로 인해 3대가 활성화됩니다.


. 서버당 최대 공유 사용자 수 _ 을(를) 활성화하여 서버당 허용되는 사용자 수에 대한 하드 제한값을 설정합니다. 이 제한을 초과하는 새 연결은 거부됩니다. 최종 사용자는 오류 메시지를 받게 되며 추가 서버를 사용할 수 있게 되면 몇 분 후에 다시 시도해야 합니다. 설정된 경우 이 숫자는 AVD 공유 서버의 깊이도 정의합니다.
+
.. Server_당 _Shared Users와 Server_ 당 _Max Shared Users 사이의 델타가 적절하다고 가정할 경우, 가장 극단적인 상황(비정상적으로 큰 로그인 스톰)을 제외한 모든 상황에서 최대값에 도달하기 전에 새 서버를 사용할 수 있어야 합니다.






== VM 리소스 확장

VM 리소스 확장은 환경에서 세션 호스트 VM의 크기와 수량을 변경할 수 있는 선택적 기능입니다.

활성화하면 VDS는 선택한 기준에 따라 세션 호스트 VM의 적절한 크기와 수량을 계산합니다. 이러한 옵션에는 활성 사용자, 명명된 사용자, 서버 로드 및 고정 이 있습니다.

image:VMResource2.png[""]

VM의 크기는 드롭다운에서 변경할 수 있는 UI에서 선택한 VM 제품군과 함께 포함됩니다. (예 _표준 DV3 제품군 _ Azure)

image:VMResource1.png[""]



=== 사용자에 따라 확장


NOTE: 아래 기능은 "활성 사용자" 또는 "사용자 수"에 대해 동일하게 작동합니다. 사용자 수는 VDS 데스크톱으로 활성화된 모든 사용자의 간단한 수입니다. 활성 사용자는 이전 2주 동안의 사용자 세션 데이터를 기반으로 계산된 변수입니다.

사용자를 기준으로 계산할 때 세션 호스트 VM의 크기(및 수량)는 정의된 RAM 및 CPU 요구 사항에 따라 계산됩니다. 관리자는 RAM GB, 사용자당 vCPU 코어 수 및 가변 리소스가 아닌 추가 리소스를 정의할 수 있습니다.

아래 스크린샷에서는 각 사용자에게 2GB RAM과 vCPU 코어 1/2가 할당됩니다. 또한 서버는 vCPU 코어 2개와 8GB RAM으로 시작합니다.

image:VMResource3.png[""]

또한 관리자는 VM이 도달할 수 있는 최대 크기를 정의할 수 있습니다. 이 수준에 도달하면 VM 세션 호스트를 추가하여 환경을 수평으로 확장할 수 있습니다.

아래 스크린샷에서 각 VM은 32GB RAM 및 8vCPU 코어로 제한됩니다.

image:VMResource4.png[""]

이러한 변수를 모두 정의하면 VDS가 적절한 세션 호스트 VM의 크기와 수량을 계산하여 사용자가 추가 및 제거되더라도 적절한 리소스 할당 유지 관리 프로세스를 크게 간소화할 수 있습니다.



=== 서버 부하에 따른 확장

서버 로드를 기준으로 계산할 때 세션 호스트 VM의 크기(및 수량)는 이전 2주 동안 VDS가 관찰한 평균 CPU/RAM 사용률을 기준으로 계산됩니다.

최대 임계값이 초과되면 VDS는 크기를 늘리거나 양을 늘려 평균 사용량을 범위 내로 다시 가져옵니다.

사용자 기반 확장과 마찬가지로 VM 제품군과 최대 VM 크기를 정의할 수 있습니다.

image:VMResource6.png[""]



== 기타 활성 리소스

워크로드 스케줄링은 WCWMGR1과 같은 플랫폼 서버를 제어하지 않습니다. WOL(Wake on Demand) 기능을 트리거하고 다른 플랫폼 작업을 용이하게 하는 데 필요하기 때문에 정상적인 환경 운영을 위해 연중 무휴로 실행해야 합니다.

전체 환경을 비활성화하여 추가적인 절감 효과를 얻을 수 있지만 비운영 환경에서만 권장됩니다. 이 작업은 VDS의 배포 섹션에서 수행할 수 있는 수동 작업입니다. 환경을 정상 상태로 되돌려면 동일한 페이지에서 수동 단계를 수행해야 합니다.

image:Stop_Deployment.png[""]
image:Start_deployment.png[""]
